오늘은 LangChain Study 첫 주차입니다~! 장염으로 시름시름 앓다가 스터디 3시간 전에 정신을 차리고... 부랴부랴 스터디 준비를 시작했습니다.. 추석인데 다들 즐추!! 보내시고 아프지마시길.. (전 추석 음식 아무것도 못 먹어요..ㅜ 따흑)


[Lang Chain 노트 책](https://wikidocs.net/book/14314)

<< 우선 해당 스터디는 GDGoC에서 진행하는 스터디로 전체적인 커리큘럼은 위 책을 사용하여 진행됨을 알려드립니다!

그럼 LangChain Study 시작해볼까요!

## 00 Lang Chain에 관하여..
저는 GDGoC의 AI 파트에 들어오면서 LangChain을 처음 접하게 되었는데요. 저같은 분들을 위해 랭체인에 대해 간략히 설명해보겠습니다. 

요즘 다들 Chat GPT 사용하시죠? 지피티가 아주 똑똑하고, 필수가 되었다지만, 아무리 지피티라도 답변하지 못하는 질문이 있습니다. 

예를 들어, 
Q) 우리 가족 중에 몸무게가 가장 많이 나가는 사람은 누구야?, 라든지 
Q) 우리 가족 제주도 여행 항공편은? 이런 비공개 데이터에 관한 질문에는 아무리 지피티라도 답을 하지 못합니다.
이런 질문에 답변이 가능하게 하려면 어떻게 해야할까요?

바로바로~~~
_질문과 관련된 참고 자료를 함께 주는 것!_
ex) 우리 가족의 몸무게는 다음과 같아 ~~

하지만 자료가 방대하다면?
질문을 할 때마다 모든 내용을 대화창에 넣기는 쉽지 않을텐데요..
데이터 양이 너무 많다면, API 비용도 증가하고, 답변 품질 또한 저하됩니다...

이러한 문제를 해결하는 기술이 바로 **RAG!!**
**R**etrieval (검색)
**A**ugmented (증강)
**G**eneration (생성)

원리는 쉽게 **오픈북 테스트**라고 생각하시면 됩니다! (지피티에게 정보를 제공하고, 정보 내에서 답변을 달라고 하는 것이죠.) 
-> 전체 내용(전체 책)중 내가 궁금한(질문 내용)만 뽑아서 질문지에 넣는 것이 RAG의 핵심입니다~!

간략히 RAG 구조를 설명하자면
우리가 질문을 하면 RAG system은
1. 우리가 준비해둔 외부 문서나 데이터 베이스에서
2. 질문과 가장 관련 높은 정보를 검색합니다. (마치 오픈북 시험에서 책에서 관련된 내용을 찾는 것과 같습니다!)
3. 이렇게 찾은 핵심 정보와 원래 질문을 함께 AI에게 넘겨 줍니다.(여기 참고 자료를 보고 답변해~)
4. 그럼 AI는 이 참고 자료를 바탕으로 훨씬 정확하고 퀄리티 높은 구체적인 답변을 생성합니다!

**하지만,,**
이런 RAG 시스템을 직접 만드려면...?
데이터를 불러오고, 검색하기 쉽게 나누고, 자료 검색하고, 모델 연결하고,,, 등등 아주아주 복잡한 작업들이 필요하겠죠....

## 이 때 필요한 것이 바로바로 Lang Chain!! 인 것입니다!!
랭체인은 마치 AI 프로그램 개발을 위한 "레고 블록 세트" 라고 할 수 있겠습니다!
RAG를 만드는데 필요한 여러 기능들을 미리 만들어진 형태들로 제공하는 것이 바로 Lang Chain입니다!

ㅎㅎ 대충 이해가 되셨나요? 그럼 Lang Chain 실습 시작해보겠습니다!! 

![](https://velog.velcdn.com/images/yuyoung924/post/10242f0d-5f39-4bb7-bb5b-0056bf9c8fa7/image.png)


## 01 환경 설정 및 OPEN API KEY 발급 받기

[macOS Lang Chain 환경 설정 바로 가기](https://teddynote.com/10-RAG비법노트/환경%20설정%20(Mac)/)
저는 macOS 사용자이기 때문에 해당 macOS 사용하시는 분들은 바로 위 링크를 통해 환경 설정해주시면 되고, window 사용자분들도 노트 책에서 바로 환경 설정을 확인하실 수 있습니다.

OPEN API 발급도 어렵지 않으니 책을 따라해주시면 됩니다!

## 02 LangSmith 추적 설정

여기서부터는 저도 처음해보는 단계라 천천히 함께 해봅시다...

LangSmith? 그게 꼭 필요할까? 뭐지? 했는데...

"LangSmith는 LLM 애플리케이션 개발, 모니터링 및 테스트 를 위한 플랫폼입니다. 프로젝트나 LangChain 학습을 시작하시는 분들이라면 LangSmith는 꼭 설정 후 진행하는 것을 추천 드립니다."

라고 하셔서.. 같이 설정을 해봅시다!

LangChain 을 실제 서비스나 연구에 쓰다 보면 “모델이 어떻게 답했는지, 어디서 잘못됐는지, 왜 이런 응답이 나왔는지”를 추적하는 게 정말 중요하잖아요. 이걸 지원하는 게 LangSmith이고, 그중 핵심 기능이 바로 추적(Tracing) 입니다.

**LangSmith는 LangChain 애플리케이션의 실행 과정 전체를 기록하고 시각화 해 줍니다.**
단순히 “최종 답변”만 보는 게 아니라:
- 어떤 프롬프트가 모델에 전달됐는지
- 모델이 어떤 응답을 했는지
- 체인/에이전트가 어떤 도구(API, DB 등)를 호출했는지
- 호출 시간이 얼마나 걸렸는지
- 에러가 났다면 어디서 났는지
전부 추적할 수 있다고 합니다!

-> 마치 디버깅 같은 느낌??

프로젝트 단위로도 추적할 수 있고, 각각의 실행에 대해 세부 단계별 추적도 가능합니다.

추적에 사용하기 위한 **LangSmith API Key**를 발급 받아보겠습니다.
1. [https://smith.langchain.com/](https://smith.langchain.com/) 으로 접속하여 회원가입을 진행합니다.
2. 가입후 이메일 인증하는 절차를 진행해야 합니다.
3. 왼쪽 톱니바퀴(Setting) - 가운데 "Personal" - "Create API Key" 를 눌러 API 키를 발급 받습니다.

![](https://velog.velcdn.com/images/yuyoung924/post/1b994e5f-f9f6-4227-9d3b-65989f4eaab5/image.png)

이렇게 발급 완료! 유출되지 않게 본인만 아는 곳에 잘 저장해둡시다 ㅎㅎ

다음으로 .env 파일에 가서 
![](https://velog.velcdn.com/images/yuyoung924/post/79f5483c-1c56-4874-b403-bacb418e8acc/image.png)
이렇게 설정 해주시면 됩니다!! 5번째 줄은 랭스미스에 표기할 프로젝트 이름을 넣어주심됩니다 ㅎㅎ

추적 활성화를 위해 아래 코드를 실행해주시면 됩니다.

``` python
from dotenv import load_dotenv

load_dotenv()
```

추적 설정을 완료하면 아래와 같이 뜨는 것을 확인할 수 있습니다.

![](https://velog.velcdn.com/images/yuyoung924/post/e425ca9c-ad7f-4d76-b4c6-a682960642ab/image.png)

cf) 추적을 원하지 않을 경우 다음과 같이 추적을 끌 수 있습니다.

``` python
from langchain_teddynote import logging

# set_enable=False 로 지정하면 추적을 하지 않습니다.
logging.langsmith("랭체인 튜토리얼 프로젝트", set_enable=False)

```
